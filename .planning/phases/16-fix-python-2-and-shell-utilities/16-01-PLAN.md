---
phase: 16-fix-python-2-and-shell-utilities
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dot_zsh.d/aliases.zsh
  - dot_zsh.d/functions.zsh
autonomous: true

must_haves:
  truths:
    - "server() function starts Python 3 http.server (not Python 2 SimpleHTTPServer)"
    - "urlencode alias uses Python 3 urllib.parse.quote_plus (not Python 2 urllib)"
    - "reloadshell alias uses exec shell reload (not stale omz command)"
    - "update alias has no npm or gem commands (mise handles runtimes)"
  artifacts:
    - path: "dot_zsh.d/functions.zsh"
      provides: "Python 3 server() function"
      contains: "http.server"
    - path: "dot_zsh.d/aliases.zsh"
      provides: "Modernised aliases"
      contains: "urllib.parse"
  key_links:
    - from: "dot_zsh.d/functions.zsh"
      to: "python3"
      via: "server() function call"
      pattern: "python3 -c.*http\\.server"
    - from: "dot_zsh.d/aliases.zsh"
      to: "python3"
      via: "urlencode alias"
      pattern: "python3 -c.*urllib\\.parse"
---

<objective>
Fix four stale shell utilities in chezmoi source: modernise Python 2 code to Python 3, replace omz reload with exec shell reload, and remove stale npm/gem commands from update alias.

Purpose: Eliminate broken/stale code so all shell utilities work on current system (Python 2 is not installed, omz is not used, npm/gem are managed by mise).
Output: Updated aliases.zsh and functions.zsh in chezmoi source.
</objective>

<execution_context>
@/Users/stephanlv_fanaka/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stephanlv_fanaka/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix aliases.zsh -- reloadshell, urlencode, and update</name>
  <files>dot_zsh.d/aliases.zsh</files>
  <action>
Edit `~/.local/share/chezmoi/dot_zsh.d/aliases.zsh` with three changes:

1. **Line 15** -- Replace stale omz reload with exec shell reload:
   Change: `alias reloadshell="omz reload"`
   To: `alias reloadshell="exec ${SHELL} -l"`
   (This matches the existing `reload` alias at line 174. Both aliases kept for discoverability.)

2. **Line 140** -- Replace Python 2 urlencode with Python 3:
   Change: `alias urlencode='python -c "import sys, urllib as ul; print ul.quote_plus(sys.argv[1]);"'`
   To: `alias urlencode='python3 -c "import sys, urllib.parse; print(urllib.parse.quote_plus(sys.argv[1]))"'`

3. **Line 67** -- Remove stale npm and gem commands from update alias:
   Change: `alias update='sudo softwareupdate -i -a; brew update; brew upgrade; brew cleanup; npm install npm -g; npm update -g; sudo gem update --system; sudo gem update; sudo gem cleanup'`
   To: `alias update='sudo softwareupdate -i -a; brew update; brew upgrade; brew cleanup'`
   (mise manages Node/Ruby runtimes and their packages now.)

Do NOT change any other lines. Do NOT reformat adjacent code.
  </action>
  <verify>
Run: `grep 'reloadshell' ~/.local/share/chezmoi/dot_zsh.d/aliases.zsh` -- must show `exec ${SHELL} -l`, not `omz`
Run: `grep 'urlencode' ~/.local/share/chezmoi/dot_zsh.d/aliases.zsh` -- must show `urllib.parse`, not `urllib as ul`
Run: `grep '^alias update=' ~/.local/share/chezmoi/dot_zsh.d/aliases.zsh` -- must NOT contain `npm` or `gem`
  </verify>
  <done>reloadshell uses exec shell, urlencode uses Python 3 urllib.parse, update has only softwareupdate + brew commands</done>
</task>

<task type="auto">
  <name>Task 2: Fix functions.zsh -- server() to use Python 3 http.server</name>
  <files>dot_zsh.d/functions.zsh</files>
  <action>
Edit `~/.local/share/chezmoi/dot_zsh.d/functions.zsh` -- replace the server() function (lines 104-110).

Change the Python 2 SimpleHTTPServer call to Python 3 http.server:

```zsh
# Start an HTTP server from a directory, optionally specifying the port
function server() {
	local port="${1:-8000}";
	sleep 1 && open "http://localhost:${port}/" &
	python3 -m http.server "$port";
}
```

Notes:
- Python 3's http.server already defaults Content-Type to text/plain for unknown extensions, so the elaborate monkey-patching from the Python 2 version is unnecessary.
- Use `python3` explicitly (not `python`) for clarity, even though there is an alias python=python3.
- Keep the sleep+open pattern for auto-opening the browser.
- Remove the old comments about Content-Type/UTF-8 overrides since they no longer apply.

Do NOT change any other functions.
  </action>
  <verify>
Run: `grep -A5 'function server()' ~/.local/share/chezmoi/dot_zsh.d/functions.zsh` -- must show `python3 -m http.server`, not `SimpleHTTPServer`
Run: `grep 'SimpleHTTPServer' ~/.local/share/chezmoi/dot_zsh.d/functions.zsh` -- must return no matches
  </verify>
  <done>server() function uses Python 3 http.server module, no Python 2 references remain</done>
</task>

</tasks>

<verification>
After both tasks, verify all four requirements:
1. `grep -c 'SimpleHTTPServer' ~/.local/share/chezmoi/dot_zsh.d/functions.zsh` returns 0
2. `grep -c 'omz reload' ~/.local/share/chezmoi/dot_zsh.d/aliases.zsh` returns 0
3. `grep -c 'urllib as ul' ~/.local/share/chezmoi/dot_zsh.d/aliases.zsh` returns 0
4. `grep 'alias update=' ~/.local/share/chezmoi/dot_zsh.d/aliases.zsh | grep -c 'npm\|gem'` returns 0

Apply changes: `chezmoi apply ~/.zsh.d/aliases.zsh ~/.zsh.d/functions.zsh`
</verification>

<success_criteria>
- CHEZFIX-05: reloadshell alias uses exec shell reload
- CHEZFIX-06: server() uses python3 -m http.server
- CHEZFIX-07: urlencode uses python3 urllib.parse
- CHEZFIX-08: update alias has no npm/gem commands
- All changes in chezmoi source (dot_zsh.d/), not target files
</success_criteria>

<output>
After completion, create `.planning/phases/16-fix-python-2-and-shell-utilities/16-01-SUMMARY.md`
</output>
