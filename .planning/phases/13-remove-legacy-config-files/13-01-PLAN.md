---
phase: 13-remove-legacy-config-files
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/13-remove-legacy-config-files/13-SCAN-REPORT.md
autonomous: true

must_haves:
  truths:
    - "Every legacy file has been checked for references in the repo and chezmoi source"
    - "A written scan report exists documenting safe-to-delete and blocked files"
    - "sheldon plugins.toml has been explicitly checked for zsh.d/ references"
    - "zsh.d/ files have been verified to exist in chezmoi dot_zsh.d/"
  artifacts:
    - path: ".planning/phases/13-remove-legacy-config-files/13-SCAN-REPORT.md"
      provides: "Reference scan results for all legacy files"
      contains: "## Scan Results"
  key_links:
    - from: "13-SCAN-REPORT.md"
      to: "13-02-PLAN.md"
      via: "Report determines which files are safe to delete"
      pattern: "safe-to-delete|blocked"
---

<objective>
Scan the entire repository and chezmoi source for references to all legacy files before any deletions happen.

Purpose: Per user decision, a full dependency scan must precede any deletions. If a legacy file is referenced elsewhere, it must be flagged and blocked from removal.
Output: Written scan report at .planning/phases/13-remove-legacy-config-files/13-SCAN-REPORT.md
</objective>

<execution_context>
@/Users/stephanlv_fanaka/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stephanlv_fanaka/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-remove-legacy-config-files/13-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scan repository for legacy file references</name>
  <files>.planning/phases/13-remove-legacy-config-files/13-SCAN-REPORT.md</files>
  <action>
Scan the entire repo and chezmoi source (~/.local/share/chezmoi) for references to each legacy file. Check BOTH symlinks and text references (source statements, PATH entries, config paths). The scan must cover:

**Category 1 — .config/ directories (10):**
aerospace, atuin, bat, btop, claude, ghostty, git, karabiner, lsd, zsh-abbr

**Category 2 — .config/ flat files (17):**
aider.conf.yml, editorconfig, finicky.js, gpgagent, hushlogin, inputrc, kitty.conf, lazygit.yml, nanorc, oh-my-posh.omp.json, psqlrc, sqliterc, ssh_config, wezterm.lua, zprofile, zshenv, zshrc

**Category 3 — zsh.d/ directory:**
- Check sheldon plugins.toml (~/.local/share/chezmoi/dot_config/sheldon/plugins.toml or equivalent) explicitly for zsh.d/ path references
- Verify every file in zsh.d/ has a corresponding file in chezmoi dot_zsh.d/ (path.zsh maps to path.zsh.tmpl — that counts)
- If any zsh.d/ file has NO counterpart in dot_zsh.d/: flag as BLOCKED

**Category 4 — Brewfiles (3):**
Brewfile, Brewfile_Client, Brewfile_Fanaka
- Check for references in any remaining scripts (install, steps/ yaml — these should be gone from Phase 12, but verify)
- Check .gitignore for existing Brewfile entries

For each file, use grep/ripgrep across:
1. The repo working tree (excluding .git/, .planning/, and the legacy files themselves)
2. The chezmoi source directory (~/.local/share/chezmoi)

**Scan approach:** For directories, search for the directory name pattern (e.g., `.config/aerospace`, `\.config/atuin`). For flat files, search for the filename. Exclude self-references (the file referencing itself).

**Output:** Write a scan report to `.planning/phases/13-remove-legacy-config-files/13-SCAN-REPORT.md` with:
- Date and scan methodology
- Per-category results table: file/directory, status (SAFE / BLOCKED), references found (if any)
- Summary: total safe, total blocked, any files requiring manual review
- If ALL files are SAFE: state "All files clear for deletion"
- If any BLOCKED: list the specific files and their references

NOTE: `.config/profile` is Phase 14 scope — do NOT include it in the scan or report.
  </action>
  <verify>
- The file .planning/phases/13-remove-legacy-config-files/13-SCAN-REPORT.md exists
- It contains results for all 4 categories (10 dirs + 17 flat files + zsh.d/ + 3 Brewfiles)
- Each entry has a SAFE or BLOCKED status
- sheldon plugins.toml was explicitly checked (mentioned in report)
- zsh.d/ file coverage against dot_zsh.d/ was verified (mentioned in report)
  </verify>
  <done>
Written scan report exists with per-file status for all 30+ legacy items. Report clearly states which files are safe to delete and which (if any) are blocked.
  </done>
</task>

</tasks>

<verification>
- Scan report covers all 4 requirement categories (LEGACY-01, LEGACY-02, LEGACY-04, LEGACY-05)
- No false negatives: scan searched both repo AND chezmoi source
- sheldon plugins.toml explicitly checked for zsh.d/ paths
- zsh.d/ to dot_zsh.d/ coverage verified
</verification>

<success_criteria>
Scan report written. Every legacy file has a SAFE or BLOCKED determination. Plan 02 can proceed with confidence about what to delete.
</success_criteria>

<output>
After completion, create `.planning/phases/13-remove-legacy-config-files/13-01-SUMMARY.md`
</output>
