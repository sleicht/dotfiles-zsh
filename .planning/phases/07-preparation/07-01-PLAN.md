---
phase: 07-preparation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.local/share/chezmoi/.chezmoiignore
autonomous: true

must_haves:
  truths:
    - "chezmoi status does not show any Dotbot infrastructure files (dotbot/, steps/, install)"
    - "chezmoi status does not show repo meta files (README.md, .planning/, Brewfile, etc.)"
    - "OS-conditional ignore blocks use valid chezmoi template syntax"
    - "All Phase 8-12 pending migration configs are listed and will be ignored until their phase"
  artifacts:
    - path: "~/.local/share/chezmoi/.chezmoiignore"
      provides: "Comprehensive ignore patterns with OS-conditional templates"
      contains: "chezmoi.os"
  key_links:
    - from: "~/.local/share/chezmoi/.chezmoiignore"
      to: "chezmoi template engine"
      via: "Go template syntax"
      pattern: "if.*chezmoi\\.os"
---

<objective>
Overhaul .chezmoiignore to comprehensively cover all Dotbot infrastructure, repo meta files, OS-specific configs, and pending Phase 8-12 migration targets.

Purpose: Prevent chezmoi from accidentally tracking Dotbot files or deploying platform-wrong configs during the v1.1 migration. This is the single most critical Phase 7 deliverable -- all subsequent phases depend on this being correct.

Output: Updated .chezmoiignore with template conditionals, phase annotations, and complete coverage.
</objective>

<execution_context>
@/Users/stephanlv_fanaka/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stephanlv_fanaka/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-preparation/07-CONTEXT.md
@.planning/phases/07-preparation/07-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Overhaul .chezmoiignore with comprehensive patterns</name>
  <files>~/.local/share/chezmoi/.chezmoiignore</files>
  <action>
  Replace the existing .chezmoiignore with a comprehensive version covering the entire v1.1 migration. The file must include ALL of the following sections:

  **1. Dotbot Infrastructure (Never Migrate):**
  - dotbot/, dotbot-asdf/, dotbot-brew/, dotfiles-marketplace/ (submodule dirs)
  - install (Dotbot installation script)
  - steps/, steps/** (Dotbot step configs)

  **2. Repository Meta Files (Never Deploy):**
  - README.md (already ignored, keep)
  - LICENSE.md, AGENTS.md, AIDER.md, CLAUDE.md
  - .editorconfig (repo-level, not home dir)
  - .gitignore, .gitmodules, .commit-message.txt
  - .git/, .github/, .idea/
  - .planning/, .planning/**
  - logs/, logs/** (application logs)
  - nvim/, nvim/** (separate neovim config, out of scope per PROJECT.md)
  - .docker/, .docker/**
  - scripts/, scripts/** (migration tooling, not deployed configs)
  - art/, art/**
  - bin/, bin/**

  **3. Package Management (Managed Separately):**
  - Brewfile, Brewfile_Client, Brewfile_Fanaka

  **4. System Configuration Scripts (Run Manually):**
  - .macos

  **5. OS-Specific Exclusions (Template Conditionals):**
  Use chezmoi template syntax:
  ```
  {{- if ne .chezmoi.os "darwin" }}
  # macOS-only configs - ignore on Linux
  .config/aerospace/
  .config/aerospace/**
  Library/
  Library/**
  .finicky.js
  {{- end }}

  {{- if ne .chezmoi.os "linux" }}
  # Linux-only configs - ignore on macOS (placeholder for future)
  .config/i3/
  .config/i3/**
  .config/sway/
  .config/sway/**
  {{- end }}
  ```

  **6. v1.0.0 Configs (Already Managed) - COMMENTS ONLY:**
  Per research recommendation, document in comments only (no ignore patterns needed since they are already in chezmoi source):
  - .zshrc, .zshenv, .zprofile, .zlogin (Phase 2)
  - .zsh.d/ (Phase 2)
  - .config/git/ (Phase 2)
  - .config/mise/ (Phase 3/5)
  - .config/sheldon/ (Phase 5)
  - .ssh/ (Phase 6)

  **7. Age Encryption Key (NEVER manage):**
  - .config/age/, .config/age/** (bootstrap key, already in existing ignore)

  **8. Pending Migration - Phase 8 (Basic Configs and CLI Tools):**
  .hushlogin, .inputrc, .nanorc, .editorconfig (home-level)
  .config/bat/, .config/lsd/, .config/btop/
  .config/oh-my-posh.omp.json
  .psqlrc, .sqliterc
  .config/zsh-abbr/
  .config/karabiner/

  **9. Pending Migration - Phase 9 (Terminal Emulators):**
  .config/kitty/, .config/ghostty/, .wezterm.lua

  **10. Pending Migration - Phase 10 (Dev Tools with Secrets):**
  .config/lazygit/, .config/atuin/
  .aider.conf.yml, .gnupg/gpg-agent.conf
  (Note: .finicky.js is in OS-conditional section above)

  **11. Pending Migration - Phase 11 (Claude Code):**
  .claude/, .claude/**

  **12. Deprecated (Phase 12 Removal):**
  .config/nushell/, zgenom/, .zgenom, .config/zgenom/

  **13. Development/Temporary (Never Manage):**
  *.tmp, *.log, *.bak, *.swp, *~, .DS_Store, firebase-debug.log

  Each section MUST have a clear comment header explaining its purpose and which phase will handle it. Use the research examples as reference but ensure all repo files discovered during analysis are included.

  IMPORTANT: The file is in chezmoi source at ~/.local/share/chezmoi/.chezmoiignore. It uses chezmoi template syntax (Go templates), NOT gitignore syntax (though patterns are similar).
  </action>
  <verify>
  1. Run `chezmoi execute-template < ~/.local/share/chezmoi/.chezmoiignore` to confirm template syntax is valid (no errors)
  2. Run `chezmoi managed` and verify NO Dotbot infrastructure files appear (dotbot/, steps/, install)
  3. Run `chezmoi managed` and verify NO repo meta files appear (README.md is already excluded, check .planning/, Brewfile, etc.)
  4. Run `chezmoi status` and verify no unexpected additions
  </verify>
  <done>
  .chezmoiignore contains all sections listed above, template syntax is valid, chezmoi managed shows only v1.0.0 configs (shell, git, mise, sheldon, ssh), and no Dotbot/meta/pending-migration files appear.
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate ignore coverage and commit</name>
  <files>~/.local/share/chezmoi/.chezmoiignore</files>
  <action>
  Run comprehensive validation of the .chezmoiignore:

  1. Run `chezmoi managed --include=files` and capture output. Verify it only contains v1.0.0 managed files:
     - dot_zshrc, dot_zshenv, dot_zprofile, dot_zsh.d/*
     - dot_gitconfig, dot_gitconfig_local.tmpl, dot_gitignore_global, dot_gitattributes_global
     - private_dot_config/git/*, private_dot_config/mise/*
     - private_dot_ssh/*
     - .chezmoidata.yaml, .chezmoi.yaml.tmpl
     - run_* scripts
     - .gitleaks.toml, .pre-commit-config.yaml

  2. Run `chezmoi status` and verify no unexpected file operations (A=add, M=modify, D=delete).

  3. Run `chezmoi diff` to confirm no pending changes would be introduced by the ignore update.

  4. If any issues are found, fix the .chezmoiignore patterns and re-validate.

  5. Commit the updated .chezmoiignore to chezmoi source git:
     ```bash
     cd ~/.local/share/chezmoi && git add .chezmoiignore && git commit -m "feat(07-01): comprehensive .chezmoiignore for v1.1 migration"
     ```
  </action>
  <verify>
  chezmoi managed output contains ONLY v1.0.0 files. chezmoi status shows no unexpected operations. chezmoi diff is clean or shows only expected changes.
  </verify>
  <done>
  .chezmoiignore is committed to chezmoi source. chezmoi managed shows exactly the files migrated in v1.0.0 phases, nothing from Dotbot or pending migration phases.
  </done>
</task>

</tasks>

<verification>
1. `chezmoi execute-template < ~/.local/share/chezmoi/.chezmoiignore` completes without error
2. `chezmoi managed --include=files | grep -E 'dotbot|steps|install|Brewfile|planning|README' | wc -l` returns 0
3. `chezmoi status` shows no unexpected file operations
4. .chezmoiignore contains OS-conditional blocks with `{{ if ne .chezmoi.os ... }}` syntax
5. .chezmoiignore has phase annotations (comments indicating Phase 8, 9, 10, 11, 12)
</verification>

<success_criteria>
- PREP-01 satisfied: chezmoi apply ignores all Dotbot infrastructure files without user intervention
- .chezmoiignore covers Dotbot infrastructure, repo meta, OS-conditionals, and all Phase 8-12 pending configs
- Template syntax is valid and renders correctly
- Committed to chezmoi source git
</success_criteria>

<output>
After completion, create `.planning/phases/07-preparation/07-01-SUMMARY.md`
</output>
