---
phase: 11-claude-code
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - scripts/verify-checks/11-claude-code.sh
autonomous: true

must_haves:
  truths:
    - "Phase 11 verification script confirms synced files exist and are deployed"
    - "Phase 11 verification confirms local state excluded from chezmoi"
    - "Phase 11 verification confirms chezmoi diff completes in under 2 seconds"
    - "Full verification suite (Phases 8-11) passes without errors"
  artifacts:
    - path: "scripts/verify-checks/11-claude-code.sh"
      provides: "Phase 11 verification check file"
      contains: "Phase 11"
  key_links:
    - from: "scripts/verify-checks/11-claude-code.sh"
      to: "scripts/verify-configs.sh"
      via: "plugin discovery pattern (auto-loaded by verify-configs.sh)"
      pattern: "verify-checks"
---

<objective>
Create Phase 11 verification check and validate full migration

Purpose: Create the verification script for Phase 11 (following the Phase 8-10 pattern) and run the full verification suite to confirm all Claude Code configs are deployed correctly, local state is excluded, and performance constraints are met (chezmoi diff < 2 seconds).

Output: Phase 11 verification check script, full verification suite passing.
</objective>

<execution_context>
@/Users/stephanlv_fanaka/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stephanlv_fanaka/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-claude-code/11-RESEARCH.md
@.planning/phases/11-claude-code/11-01-SUMMARY.md
@scripts/verify-checks/10-dev-tools-secrets.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Phase 11 verification check script</name>
  <files>scripts/verify-checks/11-claude-code.sh</files>
  <action>
Create `scripts/verify-checks/11-claude-code.sh` following the exact pattern from Phase 10 (`10-dev-tools-secrets.sh`). The script must verify all 4 Phase 11 success criteria from ROADMAP.md.

**Checks to implement:**

**Check 1: File existence (synced configs)**
Verify these files/directories exist at their deployed locations:
- `$HOME/.claude/settings.json`
- `$HOME/.claude/CLAUDE.md`
- `$HOME/.claude/agents` (directory)
- `$HOME/.claude/commands` (directory)
- `$HOME/.claude/commands/gsd` (subdirectory)
- `$HOME/.claude/skills` (directory)
- `$HOME/.claude/skills/commit-message` (subdirectory)

**Check 2: chezmoi managed (only synced files tracked)**
Verify chezmoi managed output includes:
- `.claude/settings.json`
- `.claude/CLAUDE.md`
- `.claude/agents/` files (at least 10 files expected)
- `.claude/commands/` files (at least 5 files expected)
- `.claude/skills/commit-message/SKILL.md`

**Check 3: Local state exclusion (cache/state NOT managed)**
Verify chezmoi managed does NOT include:
- `.claude/cache`
- `.claude/debug`
- `.claude/downloads`
- `.claude/history.jsonl`
- `.claude/__store.db`
- `.claude/session-env`
- `.claude/settings.local.json`
- `.claude/get-shit-done`
- `.claude/plugins`

For each, `chezmoi managed --include=files | grep ".claude/cache"` should return empty.

**Check 4: Performance (chezmoi diff under 2 seconds)**
Time `chezmoi diff` execution:
- Use nanosecond timing if available, else second-level timing
- PASS if diff completes in under 2000ms
- FAIL if diff takes 2000ms or more
- Display actual duration in output

**Check 5: Managed file count sanity**
Count `chezmoi managed --include=files | grep "\.claude" | wc -l`:
- PASS if count is between 10 and 60 (reasonable for ~48 synced files)
- FAIL if count exceeds 60 (suggests cache/state leaked into tracking)

Use the same script structure as Phase 10:
- Source verify-lib helpers
- Colour output conditional on terminal
- check_pass/check_fail counters
- Exit 0 on all pass, exit 1 on any fail
- Header: "Phase 11: Claude Code"
  </action>
  <verify>
1. `bash -n scripts/verify-checks/11-claude-code.sh` — syntax check passes
2. `head -5 scripts/verify-checks/11-claude-code.sh` — starts with `#!/usr/bin/env bash`
3. `grep -c "check_pass\|check_fail" scripts/verify-checks/11-claude-code.sh` — shows multiple check calls
4. `grep "Phase 11" scripts/verify-checks/11-claude-code.sh` — header present
5. `grep "2000" scripts/verify-checks/11-claude-code.sh` — performance threshold present
  </verify>
  <done>Phase 11 verification check script created with 5 check categories covering all 4 ROADMAP success criteria.</done>
</task>

<task type="auto">
  <name>Task 2: Run full verification suite and confirm Phase 11 passes</name>
  <files></files>
  <action>
Run the Phase 11 verification check and then the full verification suite:

**Step 1: Run Phase 11 verification**
```bash
bash scripts/verify-checks/11-claude-code.sh
```

Expected output:
- All synced file existence checks pass
- chezmoi managed shows correct files
- Local state exclusion checks pass
- chezmoi diff completes in under 2 seconds
- Managed file count is reasonable (10-60)

**Step 2: Run full verification suite (Phases 8-11)**
```bash
bash scripts/verify-configs.sh
```
or run each individually:
```bash
bash scripts/verify-checks/08-basic-configs.sh
bash scripts/verify-checks/09-terminal-emulators.sh
bash scripts/verify-checks/10-dev-tools-secrets.sh
bash scripts/verify-checks/11-claude-code.sh
```

All phases must pass. If any Phase 8-10 check fails, it indicates a regression from Phase 11 changes.

**Step 3: If any check fails**, diagnose and fix:
- If managed count is too high: check .chezmoiignore exclusions from Plan 01
- If performance check fails: identify which tracked files are too large
- If file existence fails: verify chezmoi apply deployed correctly
- If exclusion check fails: verify .chezmoiignore patterns match directory names exactly
  </action>
  <verify>
1. Phase 11 verification output shows all checks passing
2. Full verification suite (Phases 8-11) shows all checks passing
3. No regressions in Phase 8-10 verification
  </verify>
  <done>Phase 11 verification passes all checks. Full verification suite (Phases 8-11) passes without regressions. Phase 11 success criteria validated: synced files deploy, local state excluded, performance under 2 seconds.</done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **Verification script exists:** `ls scripts/verify-checks/11-claude-code.sh` exists and is valid bash
2. **Phase 11 checks pass:** `bash scripts/verify-checks/11-claude-code.sh` exits 0
3. **Full suite passes:** All verification checks (Phases 8-11) exit 0
4. **Performance validated:** chezmoi diff completes in under 2 seconds (shown in verification output)
5. **No regressions:** Phase 8-10 verification checks still pass
</verification>

<success_criteria>
- Phase 11 verification check script created and executable
- All 5 check categories pass (existence, managed, exclusion, performance, count)
- Full verification suite (Phases 8-11) passes without regressions
- chezmoi diff performance confirmed under 2 seconds
</success_criteria>

<output>
After completion, create `.planning/phases/11-claude-code/11-02-SUMMARY.md`
</output>
