---
phase: 02-chezmoi-foundation
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - ~/.local/share/chezmoi/dot_gitconfig
  - ~/.local/share/chezmoi/dot_gitignore_global
  - ~/.local/share/chezmoi/dot_gitattributes_global
autonomous: true

must_haves:
  truths:
    - "git config --list shows expected configuration"
    - "git config user.email returns configured email"
    - "git commands work correctly"
  artifacts:
    - path: "~/.local/share/chezmoi/dot_gitconfig"
      provides: "Git configuration"
      min_lines: 50
      contains: "[alias]"
    - path: "~/.local/share/chezmoi/dot_gitignore_global"
      provides: "Global gitignore patterns"
    - path: "~/.local/share/chezmoi/dot_gitattributes_global"
      provides: "Global git attributes"
    - path: "~/.gitconfig"
      provides: "Applied git config (real file, not symlink)"
  key_links:
    - from: "~/.local/share/chezmoi/dot_gitconfig"
      to: "~/.gitconfig"
      via: "chezmoi apply"
      pattern: "chezmoi managed"
    - from: "~/.gitconfig"
      to: "~/.gitignore_global"
      via: "excludesfile setting"
      pattern: "excludesfile.*gitignore_global"
---

<objective>
Migrate git configuration files from Dotbot symlinks to chezmoi management.

Purpose: Move .gitconfig, .gitignore_global, and .gitattributes_global to chezmoi for unified dotfiles management.
Output: Git config files in chezmoi source, applied to home directory as real files.
</objective>

<execution_context>
@/Users/stephanlv_fanaka/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stephanlv_fanaka/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-chezmoi-foundation/02-RESEARCH.md
@.planning/phases/02-chezmoi-foundation/02-CONTEXT.md
@.planning/phases/02-chezmoi-foundation/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add git configuration files to chezmoi</name>
  <files>~/.local/share/chezmoi/dot_gitconfig, dot_gitignore_global, dot_gitattributes_global</files>
  <action>
    Git config files are currently symlinked via Dotbot:
    - ~/.gitconfig -> ~/.dotfiles/.config/git/gitconfig
    - ~/.gitignore_global -> ~/.dotfiles/.config/git/gitignore
    - ~/.gitattributes_global -> ~/.dotfiles/.config/git/gitattributes

    1. Use chezmoi add --follow to add git config (follows symlink to source):
    ```bash
    chezmoi add --follow ~/.gitconfig
    chezmoi add --follow ~/.gitignore_global
    chezmoi add --follow ~/.gitattributes_global
    ```

    2. Add chezmoi header comment to the gitconfig file.
    Edit `~/.local/share/chezmoi/dot_gitconfig` to add at the top:
    ```ini
    # Managed by chezmoi - edit with: chezmoi edit ~/.gitconfig
    # To apply changes: chezmoi apply

    ```

    3. Verify files were added correctly:
    ```bash
    ls -la ~/.local/share/chezmoi/dot_git*
    ```

    Expected: dot_gitconfig, dot_gitignore_global, dot_gitattributes_global
  </action>
  <verify>Run `ls ~/.local/share/chezmoi/dot_git*` - should list all three files</verify>
  <done>Git config files exist in chezmoi source with correct content and header comments</done>
</task>

<task type="auto">
  <name>Task 2: Apply git configuration and verify</name>
  <files>~/.gitconfig, ~/.gitignore_global, ~/.gitattributes_global</files>
  <action>
    1. Check what chezmoi would change:
    ```bash
    chezmoi diff ~/.gitconfig ~/.gitignore_global ~/.gitattributes_global
    ```

    Should show: symlinks will be replaced with real files (same content + header comment)

    2. Remove Dotbot symlinks to allow chezmoi to manage:
    ```bash
    rm -f ~/.gitconfig ~/.gitignore_global ~/.gitattributes_global
    ```

    3. Apply chezmoi configuration:
    ```bash
    chezmoi apply --verbose ~/.gitconfig ~/.gitignore_global ~/.gitattributes_global
    ```

    4. Verify files are now real files (not symlinks):
    ```bash
    ls -la ~/.gitconfig ~/.gitignore_global ~/.gitattributes_global
    # Should show regular files, not symlinks
    ```

    5. Verify git configuration works:
    ```bash
    git config --list --show-origin | head -10
    git config user.email
    git config core.excludesfile
    ```

    Expected:
    - Config loads from ~/.gitconfig
    - User email is configured
    - excludesfile points to ~/.gitignore_global
  </action>
  <verify>Run `git config core.excludesfile` - should return ~/.gitignore_global</verify>
  <done>chezmoi apply succeeds, git config loads correctly, excludesfile references work</done>
</task>

</tasks>

<verification>
1. `ls ~/.local/share/chezmoi/dot_git*` shows all three files
2. `chezmoi verify` exits with code 0
3. `ls -la ~/.gitconfig` shows regular file (not symlink)
4. `git config --list` shows expected aliases and settings
5. `git config core.excludesfile` returns ~/.gitignore_global
6. `git config core.attributesFile` returns ~/.gitattributes_global
</verification>

<success_criteria>
- All git config files migrated to chezmoi source
- chezmoi apply creates real files in home directory
- git commands work correctly with migrated configuration
- References to gitignore_global and gitattributes_global work
</success_criteria>

<output>
After completion, create `.planning/phases/02-chezmoi-foundation/02-03-SUMMARY.md`
</output>
