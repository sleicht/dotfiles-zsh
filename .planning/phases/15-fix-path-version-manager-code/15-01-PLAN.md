---
phase: 15-fix-path-version-manager-code
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dot_zsh.d/path.zsh.tmpl
  - dot_zsh.d/variables.zsh
  - dot_zsh.d/hooks.zsh
autonomous: true

must_haves:
  truths:
    - "chezmoi path.zsh contains no Volta or rbenv PATH entries"
    - "chezmoi variables.zsh contains no hardcoded /usr/local npm PATH"
    - "chezmoi variables.zsh contains no empty Version managers section"
    - "mise activation occurs only in external.zsh, not duplicated in hooks.zsh"
    - "chezmoi hooks.zsh contains no commented-out asdf activation"
  artifacts:
    - path: "dot_zsh.d/path.zsh.tmpl"
      provides: "Clean PATH setup without stale version manager entries"
    - path: "dot_zsh.d/variables.zsh"
      provides: "Clean variables without stale npm PATH or empty sections"
    - path: "dot_zsh.d/hooks.zsh"
      provides: "Clean hooks without duplicate mise or stale asdf"
  key_links:
    - from: "dot_zsh.d/external.zsh"
      to: "mise activate zsh"
      via: "single mise activation point"
      pattern: "eval.*mise activate"
---

<objective>
Remove stale version manager code (Volta, rbenv, asdf) and duplicate mise activation from chezmoi source files.

Purpose: These PATH entries and activations reference tools replaced by mise in Phase 3. They deploy dead code to every shell session.
Output: Clean chezmoi source files with only active version manager references.
</objective>

<execution_context>
@/Users/stephanlv_fanaka/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stephanlv_fanaka/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove Volta and rbenv PATH entries from path.zsh.tmpl</name>
  <files>dot_zsh.d/path.zsh.tmpl</files>
  <action>
Edit the chezmoi source file at ~/.local/share/chezmoi/dot_zsh.d/path.zsh.tmpl:

1. Remove the rbenv section (lines 25-27):
   ```
   # Ruby (cross-platform rbenv)
   add_to_path "$HOME/.rbenv/bin"
   add_to_path "$HOME/.gem/ruby/3.4.0/bin"
   ```

2. Remove the Volta section (lines 40-42):
   ```
   # volta
   export VOLTA_HOME="$HOME/.volta"
   add_to_path "$VOLTA_HOME/bin"
   ```

Keep the blank line between sections for readability. Do NOT touch any other lines -- npm, pnpm, bun, cargo, and other PATH entries are still valid.

Requirements covered: CHEZFIX-01, CHEZFIX-02.
  </action>
  <verify>
Run: `grep -E 'rbenv|volta|VOLTA' ~/.local/share/chezmoi/dot_zsh.d/path.zsh.tmpl` -- should return no output.
Run: `grep -E 'pnpm|bun|cargo|npm' ~/.local/share/chezmoi/dot_zsh.d/path.zsh.tmpl` -- should still show these entries.
  </verify>
  <done>path.zsh.tmpl contains no Volta PATH, no VOLTA_HOME export, no rbenv PATH, no hardcoded gem version PATH. All other PATH entries preserved.</done>
</task>

<task type="auto">
  <name>Task 2: Clean variables.zsh and hooks.zsh of stale version manager code</name>
  <files>dot_zsh.d/variables.zsh, dot_zsh.d/hooks.zsh</files>
  <action>
Edit two chezmoi source files at ~/.local/share/chezmoi/dot_zsh.d/:

**variables.zsh:**

1. Remove the hardcoded /usr/local npm PATH line (line 31):
   ```
   # npm:
   PATH="/usr/local/share/npm/bin:$PATH"
   ```
   This is a stale x86 Homebrew path. mise manages node/npm now.

2. Remove the empty "Version managers" section (lines 93-94):
   ```
   # === Version managers ===
   ```
   This section header has no content below it (the next line is `# === Histories ===`). It was left behind when asdf/volta exports were removed.

Requirements covered: CHEZFIX-09, CHEZFIX-10.

**hooks.zsh:**

1. Remove the mise activation line (line 12):
   ```
   if command -v mise > /dev/null; then eval "$(mise activate zsh)"; fi
   ```
   mise is already activated in external.zsh (line 65: `eval "$(mise activate zsh)"`). This is the duplicate.

2. Remove the commented-out asdf activation line (line 13):
   ```
   #if command -v asdf > /dev/null; then . "$HOMEBREW_PREFIX/share/zsh/site-functions/_asdf"; fi
   ```
   asdf was replaced by mise in Phase 3.

Requirements covered: CHEZFIX-03, CHEZFIX-04.
  </action>
  <verify>
Run: `grep -E 'npm.*usr/local|Version managers' ~/.local/share/chezmoi/dot_zsh.d/variables.zsh` -- should return no output.
Run: `grep -E 'mise|asdf' ~/.local/share/chezmoi/dot_zsh.d/hooks.zsh` -- should return no output.
Run: `grep 'mise activate' ~/.local/share/chezmoi/dot_zsh.d/external.zsh` -- should return the single activation line.
  </verify>
  <done>variables.zsh has no /usr/local npm PATH and no empty Version managers section. hooks.zsh has no mise activation and no asdf comment. mise activates only in external.zsh.</done>
</task>

</tasks>

<verification>
1. `grep -rE 'volta|VOLTA|rbenv|asdf' ~/.local/share/chezmoi/dot_zsh.d/` -- should only match legitimate references (none expected for these tools)
2. `grep -c 'mise activate' ~/.local/share/chezmoi/dot_zsh.d/*.zsh` -- should show exactly 1 match (in external.zsh)
3. `grep '/usr/local/share/npm' ~/.local/share/chezmoi/dot_zsh.d/variables.zsh` -- should return no output
4. `chezmoi diff` -- should show only the expected removals in path.zsh, variables.zsh, hooks.zsh
</verification>

<success_criteria>
- All 6 requirements (CHEZFIX-01, -02, -03, -04, -09, -10) satisfied
- No stale version manager references in chezmoi source
- mise activates exactly once (external.zsh only)
- All other PATH entries and hooks preserved unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/15-fix-path-version-manager-code/15-01-SUMMARY.md`
</output>
