---
phase: 12-dotbot-retirement
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - scripts/verify-checks/12-dotbot-retirement.sh
  - README.md
autonomous: true

must_haves:
  truths:
    - "Verification script confirms no Dotbot symlinks remain (except intentional nvim)"
    - "Verification script confirms all Dotbot infrastructure removed from repo"
    - "Verification script confirms deprecated configs removed from repo and target"
    - "Verification script confirms chezmoi is sole dotfile manager"
    - "README documents chezmoi-only workflow with no Dotbot references"
  artifacts:
    - path: "scripts/verify-checks/12-dotbot-retirement.sh"
      provides: "Phase 12 verification check plugin"
      min_lines: 50
      contains: "check_fail"
    - path: "README.md"
      provides: "Updated documentation with chezmoi-only workflow"
      contains: "chezmoi"
  key_links:
    - from: "scripts/verify-configs.sh"
      to: "scripts/verify-checks/12-dotbot-retirement.sh"
      via: "plugin auto-discovery"
      pattern: "verify-checks/12-"
    - from: "scripts/verify-checks/12-dotbot-retirement.sh"
      to: "find ~ -type l"
      via: "symlink detection"
      pattern: "find.*type l"
---

<objective>
Create Phase 12 verification check script and update README for chezmoi-only workflow.

Purpose: The verification script validates all 5 success criteria for Phase 12 (no Dotbot symlinks, infrastructure removed, deprecated configs removed, chezmoi functional, documentation updated). The README update ensures new machine setup instructions reference only chezmoi. This is the final phase of v1.1.

Output: Verification script at scripts/verify-checks/12-dotbot-retirement.sh, updated README.md.
</objective>

<execution_context>
@/Users/stephanlv_fanaka/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stephanlv_fanaka/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-dotbot-retirement/12-RESEARCH.md
@scripts/verify-checks/08-basic-configs.sh
@scripts/verify-configs.sh
@README.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Phase 12 verification check script</name>
  <files>scripts/verify-checks/12-dotbot-retirement.sh</files>
  <action>
Create `scripts/verify-checks/12-dotbot-retirement.sh` following the exact pattern from Phases 8-11 verification scripts (see 08-basic-configs.sh for structure).

**Script structure:**
1. Header comment block explaining purpose (same style as 08-basic-configs.sh)
2. `set -euo pipefail`
3. Source verify-lib helpers from `$SCRIPT_DIR/../verify-lib/*.sh`
4. Define colour variables (conditional on terminal)
5. Implement these checks:

**Check 1: No Dotbot symlinks remain (except nvim)**
- Use `find ~ -maxdepth 3 -type l` to find all symlinks
- For each symlink, check if target contains "dotfiles-zsh"
- EXCLUDE `nvim` from failure (intentional exception, not managed by chezmoi)
- Also EXCLUDE `.planning` and `.git` paths (internal repo references)
- Any remaining dotfiles-zsh symlink = check_fail

**Check 2: Dotbot infrastructure removed from repository**
- Check that these do NOT exist in the repository (relative to REPO_DIR):
  - `install` (script)
  - `steps/` (directory)
  - `dotbot/` (submodule)
  - `dotbot-asdf/` (submodule)
  - `dotbot-brew/` (submodule)
  - `.gitmodules` (submodule config)
- Each existing item = check_fail
- Use REPO_DIR derived from script location: `REPO_DIR="$(cd "$SCRIPT_DIR/../.." && pwd)"`

**Check 3: Deprecated configs removed from repository**
- Check that these do NOT exist in the repository:
  - `.config/nushell/` (CLEAN-01)
  - `.config/zgenom/` (CLEAN-02)
  - `zgenom/` (submodule, CLEAN-02)
- Each existing item = check_fail

**Check 4: Deprecated configs removed from target (home directory)**
- Check that these do NOT exist:
  - `$HOME/.config/nushell`
  - `$HOME/.config/zgenom`
  - `$HOME/.zgenom`
- Each existing item = check_fail

**Check 5: chezmoi is sole dotfile manager**
- `chezmoi managed --include=files` returns at least 10 files (sanity check)
- `chezmoi diff` completes without error (exit code 0)

**Use the check_fail / check_pass pattern from verify-lib.** If the helper functions are not available (sourcing failed), define local pass/fail tracking with CHECKS_RUN and CHECKS_FAILED counters, incrementing on each check and printing summary at end.

Make script executable: `chmod +x scripts/verify-checks/12-dotbot-retirement.sh`
  </action>
  <verify>
Run the verification:
- `bash scripts/verify-checks/12-dotbot-retirement.sh` -- all checks should pass
- `bash scripts/verify-configs.sh` -- full suite (Phases 8-12) should pass
- Script is executable: `test -x scripts/verify-checks/12-dotbot-retirement.sh`
  </verify>
  <done>
Phase 12 verification script exists at scripts/verify-checks/12-dotbot-retirement.sh, is executable, follows the Phase 8-11 pattern, checks all 5 success criteria, and passes when run. Full verification suite (scripts/verify-configs.sh) discovers and runs it successfully alongside Phase 8-11 checks.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update README for chezmoi-only workflow</name>
  <files>README.md</files>
  <action>
Update README.md to reflect that Dotbot is fully retired and chezmoi is the sole dotfile manager. The current README already references chezmoi as primary, but needs cleanup:

1. **Read current README.md** to understand existing structure and content.

2. **Remove any remaining Dotbot references:**
   - Search for "Dotbot", "dotbot", "install script", "submodule" references
   - Remove or replace any mentions of the old `./install` workflow
   - Remove mentions of "steps/" or "terminal.yml"
   - Remove mentions of zgenom as a plugin manager (Sheldon replaced it in v1.0.0)

3. **Ensure Fresh Machine Setup section is chezmoi-only:**
   - The existing Fresh Machine Setup section already shows chezmoi workflow -- verify it has no Dotbot fallback
   - If there is any mention of `./install` or Dotbot as alternative, remove it

4. **Keep existing content that is still accurate:**
   - chezmoi workflow, mise, Bitwarden, age, gitleaks sections are all correct
   - Architecture diagram is correct
   - Common Tasks section is correct

5. **Add brief note about nvim exception** if not already present:
   - nvim config is managed separately (symlink to dotfiles-zsh/nvim), not by chezmoi
   - This is intentional -- nvim has its own plugin management

6. **Do NOT over-edit.** The current README is already well-written for chezmoi. Only remove stale Dotbot references and add the nvim note if missing. Minimal changes.
  </action>
  <verify>
Verify README accuracy:
- `grep -i dotbot README.md` returns no matches (no Dotbot references)
- `grep -i "install script" README.md` returns no matches
- `grep -i zgenom README.md` returns no matches
- `grep -i "chezmoi" README.md` returns multiple matches (chezmoi documented)
- `grep -i "nvim" README.md` returns at least one match (exception documented)
  </verify>
  <done>
README.md updated: all Dotbot references removed, chezmoi-only workflow documented, nvim exception noted. No references to ./install script, steps/ directory, zgenom, or submodules remain. Fresh machine setup instructions work with chezmoi only.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `bash scripts/verify-configs.sh` -- full verification suite passes (Phases 8-12)
2. `bash scripts/verify-checks/12-dotbot-retirement.sh` -- Phase 12 checks pass individually
3. `grep -ic dotbot README.md` returns 0 -- no Dotbot references in README
4. `grep -c chezmoi README.md` returns 10+ -- chezmoi well-documented
5. All Phase 12 success criteria from ROADMAP.md are met:
   - No Dotbot symlinks remain in filesystem
   - Dotbot infrastructure removed from repository
   - Deprecated configs removed from repo and target
   - chezmoi-only workflow documented in README
   - chezmoi apply deploys all configs correctly
</verification>

<success_criteria>
- Verification script scripts/verify-checks/12-dotbot-retirement.sh exists and passes
- Full verification suite (scripts/verify-configs.sh) passes all phases 8-12
- README.md contains zero Dotbot/zgenom references
- README.md documents chezmoi as sole dotfile manager
- nvim exception documented in README
</success_criteria>

<output>
After completion, create `.planning/phases/12-dotbot-retirement/12-02-SUMMARY.md`
</output>
