---
phase: 12-dotbot-retirement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .config/nushell/config.nu
  - .config/nushell/env.nu
  - .config/nushell/history.txt
  - .config/zgenom/zgenomrc.zsh
  - .gitmodules
  - dotbot/
  - dotbot-asdf/
  - dotbot-brew/
  - zgenom/
  - install
  - steps/terminal.yml
  - steps/dependencies.yml
autonomous: true

must_haves:
  truths:
    - "Deprecated nushell config no longer exists in repository or home directory"
    - "Deprecated zgenom config and submodule no longer exist in repository or home directory"
    - "No Dotbot submodules remain (dotbot, dotbot-asdf, dotbot-brew, zgenom all removed)"
    - "Dotbot install script and steps/ directory no longer exist in repository"
    - ".gitmodules file is removed (no submodules remain)"
  artifacts:
    - path: ".config/nushell"
      provides: "REMOVED - deprecated config directory"
      contains: "MUST NOT EXIST"
    - path: ".config/zgenom"
      provides: "REMOVED - deprecated config directory"
      contains: "MUST NOT EXIST"
    - path: "dotbot"
      provides: "REMOVED - submodule directory"
      contains: "MUST NOT EXIST"
    - path: "dotbot-asdf"
      provides: "REMOVED - submodule directory"
      contains: "MUST NOT EXIST"
    - path: "dotbot-brew"
      provides: "REMOVED - submodule directory"
      contains: "MUST NOT EXIST"
    - path: "zgenom"
      provides: "REMOVED - submodule directory"
      contains: "MUST NOT EXIST"
    - path: "install"
      provides: "REMOVED - Dotbot install script"
      contains: "MUST NOT EXIST"
    - path: "steps"
      provides: "REMOVED - Dotbot config directory"
      contains: "MUST NOT EXIST"
    - path: ".gitmodules"
      provides: "REMOVED - no submodules remain"
      contains: "MUST NOT EXIST"
  key_links:
    - from: "chezmoi managed"
      to: "all previously-migrated configs"
      via: "chezmoi still deploys all Phase 8-11 configs"
      pattern: "chezmoi managed.*config"
---

<objective>
Remove all deprecated configs and Dotbot infrastructure from the repository and target filesystem.

Purpose: This is the point of no return -- retire Dotbot entirely now that all configs are migrated to chezmoi (Phases 7-11 complete). Deprecated configs (nushell, zgenom) are no longer in use and must be cleaned up. All 4 git submodules (dotbot, dotbot-asdf, dotbot-brew, zgenom) and the Dotbot install script/steps directory must be removed.

Output: Clean repository with no Dotbot traces, no deprecated configs, no submodules.
</objective>

<execution_context>
@/Users/stephanlv_fanaka/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stephanlv_fanaka/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-dotbot-retirement/12-RESEARCH.md
@.gitmodules
@install
@steps/terminal.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove deprecated nushell and zgenom configs</name>
  <files>
    .config/nushell/config.nu
    .config/nushell/env.nu
    .config/nushell/history.txt
    .config/zgenom/zgenomrc.zsh
  </files>
  <action>
Remove deprecated configuration files that are no longer in use:

1. **Verify NOT managed by chezmoi** before removal:
   - Run `chezmoi managed --include=files | grep nushell` -- must return empty
   - Run `chezmoi managed --include=files | grep zgenom` -- must return empty
   - If either returns results, STOP and report -- something is wrong

2. **Remove nushell config from repository** (CLEAN-01):
   - `git rm -rf .config/nushell/` (removes config.nu, env.nu, history.txt)

3. **Remove nushell config from target filesystem**:
   - Remove `~/.config/nushell` if it exists (may be a symlink or directory)
   - Use `rm -rf "$HOME/.config/nushell"` (handles both symlink and real directory)

4. **Remove zgenom config from repository** (CLEAN-02 partial):
   - `git rm -rf .config/zgenom/` (removes zgenomrc.zsh)

5. **Remove zgenom from target filesystem**:
   - Remove `~/.config/zgenom` if it exists: `rm -rf "$HOME/.config/zgenom"`
   - Remove `~/.zgenom` if it exists: `rm -rf "$HOME/.zgenom"` (this is the symlink to the zgenom submodule)

Do NOT remove `nvim` symlink (`~/.config/nvim` -> dotfiles-zsh/nvim) -- it is intentionally NOT managed by chezmoi.
  </action>
  <verify>
Verify removal:
- `ls .config/nushell 2>/dev/null` returns error (not in repo)
- `ls .config/zgenom 2>/dev/null` returns error (not in repo)
- `ls -la "$HOME/.config/nushell" 2>/dev/null` returns error (not in home)
- `ls -la "$HOME/.config/zgenom" 2>/dev/null` returns error (not in home)
- `ls -la "$HOME/.zgenom" 2>/dev/null` returns error (not in home)
- `git status` shows .config/nushell and .config/zgenom as deleted
  </verify>
  <done>
Nushell config removed from repository and home directory. Zgenom config removed from repository and home directory. ~/.zgenom symlink removed. No impact on chezmoi-managed configs.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove Dotbot submodules and infrastructure</name>
  <files>
    .gitmodules
    dotbot/
    dotbot-asdf/
    dotbot-brew/
    zgenom/
    install
    steps/terminal.yml
    steps/dependencies.yml
  </files>
  <action>
Remove all Dotbot infrastructure using the three-step submodule removal pattern (CLEAN-03):

1. **Remove all 4 git submodules** using the proven three-step process for each:
   ```
   SUBMODULES=("dotbot" "dotbot-asdf" "dotbot-brew" "zgenom")
   for submodule in "${SUBMODULES[@]}"; do
     git submodule deinit -f "$submodule"
     git rm -f "$submodule"
     rm -rf ".git/modules/$submodule"
   done
   ```
   The `git rm` command automatically updates .gitmodules. After all 4 are removed, .gitmodules should be empty or auto-deleted.

2. **Handle .gitmodules cleanup**:
   - After removing all submodules, check if `.gitmodules` still exists
   - If it exists but is empty or has no `[submodule` entries, remove it: `git rm .gitmodules`
   - Modern Git (2.22+) should handle this automatically

3. **Remove Dotbot install script**:
   - `git rm install`

4. **Remove steps/ directory**:
   - `git rm -rf steps/`

5. **Verify .git/modules is clean**:
   - `ls .git/modules/` should show no dotbot-related directories
   - If any remain, `rm -rf .git/modules/dotbot .git/modules/dotbot-asdf .git/modules/dotbot-brew .git/modules/zgenom`

6. **Verify git submodule status**:
   - `git submodule status` should return empty (no submodules registered)

Critical ordering: Submodule deinit BEFORE git rm. Never skip the `rm -rf .git/modules/` step.
  </action>
  <verify>
Verify complete removal:
- `git submodule status` returns empty
- `ls dotbot 2>/dev/null` returns error
- `ls dotbot-asdf 2>/dev/null` returns error
- `ls dotbot-brew 2>/dev/null` returns error
- `ls zgenom 2>/dev/null` returns error
- `ls install 2>/dev/null` returns error
- `ls steps 2>/dev/null` returns error
- `ls .gitmodules 2>/dev/null` returns error
- `ls .git/modules/dotbot 2>/dev/null` returns error
- `ls .git/modules/zgenom 2>/dev/null` returns error
- `chezmoi diff` still works (chezmoi unaffected by removal)
  </verify>
  <done>
All 4 git submodules (dotbot, dotbot-asdf, dotbot-brew, zgenom) completely removed including .git/modules metadata. Dotbot install script deleted. steps/ directory deleted. .gitmodules file removed. No submodules registered in git. chezmoi continues to function normally.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `git submodule status` returns empty -- no submodules
2. `git status` shows all removals staged
3. `chezmoi managed --include=files | wc -l` returns same count as before Phase 12 -- no managed files lost
4. `chezmoi diff` completes without error -- chezmoi unaffected
5. No deprecated configs in repo: `ls .config/nushell .config/zgenom 2>&1 | grep -c "No such file"` returns 2
6. No Dotbot infrastructure in repo: `ls install steps dotbot dotbot-asdf dotbot-brew zgenom .gitmodules 2>&1 | grep -c "No such file"` returns 7
</verification>

<success_criteria>
- Zero git submodules registered
- Zero Dotbot infrastructure files in repository (install, steps/, dotbot/, dotbot-asdf/, dotbot-brew/)
- Zero deprecated configs in repository (.config/nushell/, .config/zgenom/)
- Zero deprecated configs in home directory (~/.config/nushell, ~/.config/zgenom, ~/.zgenom)
- chezmoi managed file count unchanged from pre-Phase 12
- chezmoi diff completes successfully
</success_criteria>

<output>
After completion, create `.planning/phases/12-dotbot-retirement/12-01-SUMMARY.md`
</output>
