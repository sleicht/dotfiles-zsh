---
phase: 09-terminal-emulators
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.local/share/chezmoi/private_dot_config/kitty/kitty.conf
  - ~/.local/share/chezmoi/private_dot_config/ghostty/config
  - ~/.local/share/chezmoi/dot_wezterm.lua
  - ~/.local/share/chezmoi/.chezmoiignore
autonomous: true

must_haves:
  truths:
    - "All 3 terminal emulator configs exist in chezmoi source directory with correct naming"
    - "Phase 9 ignore block removed from .chezmoiignore"
    - "kitty cache/theme exclusion patterns added to .chezmoiignore"
    - "chezmoi apply deploys real files (not symlinks) for all 3 terminal configs"
    - "Existing Dotbot symlinks replaced with chezmoi-managed real files"
  artifacts:
    - path: "~/.local/share/chezmoi/private_dot_config/kitty/kitty.conf"
      provides: "kitty terminal configuration (2600 lines)"
    - path: "~/.local/share/chezmoi/private_dot_config/ghostty/config"
      provides: "ghostty terminal configuration (39 lines)"
    - path: "~/.local/share/chezmoi/dot_wezterm.lua"
      provides: "wezterm terminal configuration (135 lines)"
    - path: "~/.local/share/chezmoi/.chezmoiignore"
      provides: "Updated ignore file with Phase 9 block removed and cache exclusions added"
  key_links:
    - from: "~/.local/share/chezmoi/private_dot_config/kitty/kitty.conf"
      to: "~/.config/kitty/kitty.conf"
      via: "chezmoi apply"
      pattern: "real file, not symlink"
    - from: "~/.local/share/chezmoi/private_dot_config/ghostty/config"
      to: "~/.config/ghostty/config"
      via: "chezmoi apply"
      pattern: "real file, not symlink"
    - from: "~/.local/share/chezmoi/dot_wezterm.lua"
      to: "~/.wezterm.lua"
      via: "chezmoi apply"
      pattern: "real file, not symlink"
    - from: ".chezmoiignore cache exclusions"
      to: "chezmoi diff"
      via: "kitty theme files excluded from tracking"
      pattern: "chezmoi diff shows no changes for cache files"
---

<objective>
Migrate all 3 terminal emulator configs from Dotbot symlinks to chezmoi source, update .chezmoiignore to remove the Phase 9 pending block and add kitty cache exclusion patterns, then apply to deploy real files.

Purpose: Replace Dotbot-managed symlinks with chezmoi-managed real files for terminal emulator configs (kitty, ghostty, wezterm) while preventing kitty theme cache files from triggering spurious diffs.
Output: All 3 terminal configs in chezmoi source with proper naming, .chezmoiignore updated with cache exclusions, real files deployed to $HOME.
</objective>

<execution_context>
@/Users/stephanlv_fanaka/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stephanlv_fanaka/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-terminal-emulators/09-RESEARCH.md
@.planning/phases/08-basic-configs-cli-tools/08-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add all 3 terminal emulator configs to chezmoi source</name>
  <files>
    ~/.local/share/chezmoi/private_dot_config/kitty/kitty.conf
    ~/.local/share/chezmoi/private_dot_config/ghostty/config
    ~/.local/share/chezmoi/dot_wezterm.lua
  </files>
  <action>
Migrate terminal emulator configs using `chezmoi add --follow` to resolve Dotbot symlinks and capture actual file content.

**IMPORTANT: Correct file locations (verified on filesystem):**
- kitty: `~/.config/kitty/kitty.conf` (symlink -> `~/Projects/dotfiles-zsh/.config/kitty.conf`)
- ghostty: `~/.config/ghostty/config` (symlink -> `~/Projects/dotfiles-zsh/.config/ghostty/config`)
- wezterm: `~/.wezterm.lua` (symlink -> `~/Projects/dotfiles-zsh/.config/wezterm.lua`)

Note: The research file has INCORRECT paths for kitty and wezterm. kitty.conf is at `~/.config/kitty/kitty.conf` (inside kitty/ directory), NOT at `~/.config/kitty.conf`. wezterm is at `~/.wezterm.lua` (home root), NOT at `~/.config/wezterm/wezterm.lua`.

**Migration commands:**
```bash
# ghostty: single file in ghostty/ directory
chezmoi add --follow ~/.config/ghostty/config

# wezterm: single file in home root (dot_wezterm.lua in chezmoi source)
chezmoi add --follow ~/.wezterm.lua

# kitty: single file inside kitty/ directory
# NOTE: chezmoi add --follow may fail for files within symlinked directories.
# If it fails, use the Phase 8 workaround: manual cp -L to chezmoi source.
chezmoi add --follow ~/.config/kitty/kitty.conf
```

**If chezmoi add --follow fails for kitty** (known issue with directories containing symlinks):
```bash
# Phase 8 workaround: manual copy with symlink dereferencing
mkdir -p ~/.local/share/chezmoi/private_dot_config/kitty
cp -L ~/.config/kitty/kitty.conf ~/.local/share/chezmoi/private_dot_config/kitty/kitty.conf
```

After adding, verify all 3 configs appear in chezmoi source:
```bash
ls -la ~/.local/share/chezmoi/private_dot_config/kitty/kitty.conf
ls -la ~/.local/share/chezmoi/private_dot_config/ghostty/config
ls -la ~/.local/share/chezmoi/dot_wezterm.lua
```

All must be regular files (not symlinks) in the chezmoi source.
  </action>
  <verify>
All 3 files exist in chezmoi source as regular files:
```bash
file ~/.local/share/chezmoi/private_dot_config/kitty/kitty.conf  # Should NOT show "symbolic link"
file ~/.local/share/chezmoi/private_dot_config/ghostty/config     # Should NOT show "symbolic link"
file ~/.local/share/chezmoi/dot_wezterm.lua                       # Should NOT show "symbolic link"
```
  </verify>
  <done>All 3 terminal emulator config files exist in chezmoi source directory with correct chezmoi naming (private_dot_config/kitty/kitty.conf, private_dot_config/ghostty/config, dot_wezterm.lua) containing actual file content (not symlinks).</done>
</task>

<task type="auto">
  <name>Task 2: Update .chezmoiignore with cache exclusions and apply configs</name>
  <files>~/.local/share/chezmoi/.chezmoiignore</files>
  <action>
Edit `~/.local/share/chezmoi/.chezmoiignore` to:

1. **Remove the entire Phase 9 pending block** (Section 8, lines 118-125). Delete from the comment header "# 8. Pending Migration -- Phase 9" through the `.wezterm.lua` pattern. This allows chezmoi to manage these terminal configs.

2. **Replace removed block with kitty cache exclusion patterns.** The new Section 8 should be:
```
# -----------------------------------------------------------------------------
# 8. Terminal Emulator Cache (Exclude auto-generated files)
# These files are generated by terminal emulators at runtime.
# kitty theme switching creates these when using `kitten themes`.
# ghostty state at ~/.local/state/ is outside .config (already excluded).
# wezterm has no cache in .config or $HOME.
# -----------------------------------------------------------------------------
.config/kitty/current-theme.conf
.config/kitty/dark-theme.auto.conf
.config/kitty/light-theme.auto.conf
.config/kitty/no-preference-theme.auto.conf
.config/kitty/themes
.config/kitty/themes/**
```

3. **Renumber remaining sections.** After replacement:
   - Section 8: Terminal Emulator Cache (new)
   - Section 9: Pending Migration -- Phase 10 (was Section 9, unchanged)
   - Section 10: Pending Migration -- Phase 11 (was Section 10, unchanged)
   - Section 11: Deprecated Phase 12 (was Section 11, unchanged)
   - Section 12: Development/Temporary Files (was Section 12, unchanged)

   No renumbering needed since the old Section 8 is replaced (not removed), and Sections 9-12 stay at the same numbers.

4. **Verify .chezmoiignore parses correctly:**
```bash
chezmoi execute-template < ~/.local/share/chezmoi/.chezmoiignore
```
Should output without errors.

5. **Check Phase 9 terminal configs now appear as managed:**
```bash
chezmoi managed --include=files | grep -E '(kitty|ghostty|wezterm)'
```
Should show all 3 terminal configs.

6. **Preview and apply** (use --force with specific paths to bypass Bitwarden auth gate):
```bash
chezmoi diff
chezmoi apply --force ~/.config/kitty/kitty.conf ~/.config/ghostty/config ~/.wezterm.lua
```

7. **Verify deployed files are real files, not symlinks:**
```bash
ls -la ~/.config/kitty/kitty.conf ~/.config/ghostty/config ~/.wezterm.lua
```
All should show regular files (no `->` symlink arrows).
  </action>
  <verify>
```bash
# Phase 9 terminal configs managed by chezmoi
chezmoi managed --include=files | grep -cE '(kitty|ghostty|wezterm)'  # Expected: 3

# Files deployed as real files (not symlinks)
test -f ~/.config/kitty/kitty.conf && ! test -L ~/.config/kitty/kitty.conf && echo "OK: kitty real file" || echo "FAIL"
test -f ~/.config/ghostty/config && ! test -L ~/.config/ghostty/config && echo "OK: ghostty real file" || echo "FAIL"
test -f ~/.wezterm.lua && ! test -L ~/.wezterm.lua && echo "OK: wezterm real file" || echo "FAIL"

# .chezmoiignore has no Phase 9 pending section
grep -c "Phase 9" ~/.local/share/chezmoi/.chezmoiignore  # Expected: 0

# Cache exclusions present
grep -c "current-theme.conf" ~/.local/share/chezmoi/.chezmoiignore  # Expected: 1
```
  </verify>
  <done>Phase 9 ignore block removed from .chezmoiignore, kitty cache exclusion patterns added, all 3 terminal configs deployed as real files via chezmoi apply, no Dotbot symlinks remain for Phase 9 files.</done>
</task>

</tasks>

<verification>
1. `chezmoi managed --include=files` shows all 3 Phase 9 terminal configs
2. `chezmoi diff` shows no pending changes for Phase 9 files
3. All deployed files are regular files (not symlinks): `! test -L ~/.config/kitty/kitty.conf`
4. `.chezmoiignore` has no "Phase 9" pending section remaining
5. `.chezmoiignore` has kitty cache exclusion patterns (current-theme.conf, *-theme.auto.conf, themes/**)
6. `.chezmoiignore` renders without template errors: `chezmoi execute-template < ~/.local/share/chezmoi/.chezmoiignore`
</verification>

<success_criteria>
- All 3 terminal configs added to chezmoi source with correct naming
- Phase 9 .chezmoiignore pending block replaced with cache exclusion section
- `chezmoi apply` deploys real files to correct $HOME paths
- No Dotbot symlinks remain for Phase 9 configs
- kitty theme cache files will not trigger chezmoi diff
</success_criteria>

<output>
After completion, create `.planning/phases/09-terminal-emulators/09-01-SUMMARY.md`
</output>
