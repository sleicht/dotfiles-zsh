---
phase: 09-terminal-emulators
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - scripts/verify-checks/09-terminal-emulators.sh
autonomous: true

must_haves:
  truths:
    - "Verification script confirms all 3 terminal emulator configs exist as deployed files"
    - "Verification script confirms no Dotbot symlinks remain for terminal configs"
    - "ghostty config parsable (ghostty installed)"
    - "wezterm config parsable (wezterm installed)"
    - "kitty config check skipped gracefully when kitty not installed"
    - "kitty cache/theme files do not appear in chezmoi diff"
    - "Verification runner discovers and executes Phase 9 checks"
  artifacts:
    - path: "scripts/verify-checks/09-terminal-emulators.sh"
      provides: "Phase 9 verification check file"
  key_links:
    - from: "scripts/verify-checks/09-terminal-emulators.sh"
      to: "scripts/verify-configs.sh"
      via: "Plugin discovery (verify-checks/*.sh glob)"
      pattern: "verify-configs.sh --phase 09 discovers 09-terminal-emulators.sh"
    - from: "scripts/verify-checks/09-terminal-emulators.sh"
      to: "scripts/verify-lib/check-exists.sh"
      via: "source helper"
      pattern: "check_file_exists function"
    - from: "scripts/verify-checks/09-terminal-emulators.sh"
      to: "scripts/verify-lib/check-parsable.sh"
      via: "source helper"
      pattern: "check_app_can_parse function"
---

<objective>
Create the Phase 9 verification check file and run full verification to confirm all 3 terminal emulator configs deploy correctly, are parsable by installed terminals, and that kitty cache files are properly excluded.

Purpose: Validate the terminal emulator migration is complete and functional using the verification framework established in Phase 7.
Output: Passing verification check file at `scripts/verify-checks/09-terminal-emulators.sh`, all checks green.
</objective>

<execution_context>
@/Users/stephanlv_fanaka/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stephanlv_fanaka/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-terminal-emulators/09-RESEARCH.md
@.planning/phases/08-basic-configs-cli-tools/08-02-SUMMARY.md
@.planning/phases/09-terminal-emulators/09-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Phase 9 verification check file</name>
  <files>scripts/verify-checks/09-terminal-emulators.sh</files>
  <action>
Create `scripts/verify-checks/09-terminal-emulators.sh` following the Phase 8 verification pattern (`08-basic-configs.sh`). This file is auto-discovered by `scripts/verify-configs.sh` via the `verify-checks/*.sh` glob.

The check file must:
1. Source the helper functions from verify-lib (check_file_exists, check_app_can_parse, check_no_template_errors)
2. Set a non-zero exit code on ANY failure
3. Track pass/fail counts and print results

**File existence checks (3 terminal configs):**
- `$HOME/.config/kitty/kitty.conf`
- `$HOME/.config/ghostty/config`
- `$HOME/.wezterm.lua`

**Not-a-symlink checks (all 3 configs):**
- Each file must be a regular file, NOT a symlink (`! test -L "$path"`)
- Confirms chezmoi replaced Dotbot symlinks with real files

**Template error checks:**
- Use `check_no_template_errors` on all 3 files
- wezterm.lua uses Lua syntax, NOT Go templates, so template check should pass
- ghostty config is plain text, no template syntax
- kitty.conf is plain text, no template syntax

**Application parsability checks (non-fatal when app not installed):**
- ghostty: `ghostty --version` (ghostty is installed, basic version check confirms binary works)
- wezterm: `wezterm --version` (wezterm is installed, version check confirms binary works)
- kitty: `kitty --debug-config` (kitty is NOT installed, skip gracefully with informational message)

**Important:** Application parsability checks MUST be non-fatal when the app is not installed. Use `command -v <app> &>/dev/null` guard before attempting the check. If app is missing, print informational skip message (do NOT increment fail counter).

**Cache exclusion check:**
- Verify that kitty cache files (if they exist on disk) do NOT appear in `chezmoi managed` output
- Run `chezmoi diff` and verify no terminal cache files appear
- This confirms .chezmoiignore cache exclusion patterns work correctly

Follow the exact structure of `scripts/verify-checks/08-basic-configs.sh` for consistency:
- `set -euo pipefail`
- Source all verify-lib helpers
- Colour output with terminal detection
- Declare config path arrays
- Check counters with check_pass/check_fail functions
- Results section with exit code

The script must be executable (`chmod +x`).
  </action>
  <verify>
```bash
# Script passes syntax check
bash -n scripts/verify-checks/09-terminal-emulators.sh

# Script is executable
test -x scripts/verify-checks/09-terminal-emulators.sh && echo "OK" || echo "FAIL"
```
  </verify>
  <done>Phase 9 verification check file exists at scripts/verify-checks/09-terminal-emulators.sh, passes bash syntax check, and is executable.</done>
</task>

<task type="auto">
  <name>Task 2: Run verification and confirm all checks pass</name>
  <files></files>
  <action>
Run the verification framework to confirm all Phase 9 checks pass:

```bash
./scripts/verify-configs.sh --phase 09 --verbose
```

Expected output:
- 3 file existence checks pass (kitty.conf, ghostty config, wezterm.lua)
- 3 not-a-symlink checks pass (all real files)
- 3 template error checks pass (no unprocessed {{ }} markers)
- ghostty version check passes (installed)
- wezterm version check passes (installed)
- kitty check skipped gracefully (not installed)
- Cache exclusion check passes

If any check fails:
- **File not found:** Check `chezmoi managed --include=files` and run `chezmoi apply --force` if needed
- **Still a symlink:** Run `chezmoi apply` again. Check .chezmoiignore for leftover Phase 9 ignore patterns
- **Parse failure:** Check app is installed (`command -v ghostty`). If missing, not a Phase 9 blocker

Also run the full verification suite (all phases) to confirm no regressions:
```bash
./scripts/verify-configs.sh
```

Confirm Phase 9 ROADMAP success criteria:
1. kitty terminal config managed by chezmoi: `chezmoi managed | grep kitty` (config exists even though terminal not installed)
2. ghostty terminal config managed by chezmoi: `chezmoi managed | grep ghostty`
3. wezterm terminal config managed by chezmoi: `chezmoi managed | grep wezterm`
4. Terminal cache files do not trigger diffs: `chezmoi diff | grep -c "current-theme\|theme.auto"` (expected: 0)
  </action>
  <verify>
```bash
# Phase 9 verification passes
./scripts/verify-configs.sh --phase 09
echo "Exit code: $?"  # Expected: 0
```
  </verify>
  <done>All Phase 9 verification checks pass. The 4 ROADMAP success criteria are confirmed: kitty config managed (even though not installed), ghostty launches with chezmoi config, wezterm launches with chezmoi config, cache files do not trigger diffs.</done>
</task>

</tasks>

<verification>
1. `./scripts/verify-configs.sh --phase 09` exits with code 0 (all checks pass)
2. All 3 files exist at target paths and are NOT symlinks
3. ghostty and wezterm pass application checks
4. kitty check skipped gracefully (not installed)
5. No chezmoi diff noise from kitty cache/theme files
6. Full verification suite (`./scripts/verify-configs.sh`) passes without regressions
</verification>

<success_criteria>
- scripts/verify-checks/09-terminal-emulators.sh exists, is executable, passes bash -n
- ./scripts/verify-configs.sh --phase 09 exits 0
- All 4 ROADMAP success criteria for Phase 9 are satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/09-terminal-emulators/09-02-SUMMARY.md`
</output>
