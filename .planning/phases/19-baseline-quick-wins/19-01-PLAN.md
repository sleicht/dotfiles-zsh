---
phase: 19-baseline-quick-wins
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Three-stage baseline measurement recorded (hyperfine, EPOCHREALTIME, zsh-bench)"
    - "zsh-bench is installed and executable"
    - "Baseline numbers documented for comparison after quick wins"
  artifacts:
    - path: ".planning/phases/19-baseline-quick-wins/19-01-SUMMARY.md"
      provides: "Baseline measurement results"
  key_links: []
---

<objective>
Establish a three-stage performance baseline for ZSH shell startup before applying any optimisations.

Purpose: Without a reliable baseline, we cannot measure the impact of quick wins or confirm progress toward the < 300ms target.
Output: Documented baseline measurements (hyperfine wall-clock, EPOCHREALTIME top bottlenecks, zsh-bench interactive latency metrics).
</objective>

<execution_context>
@/Users/stephanlv_fanaka/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stephanlv_fanaka/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-baseline-quick-wins/19-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install zsh-bench and run three-stage baseline</name>
  <files></files>
  <action>
1. Check if hyperfine is installed (`brew list hyperfine`). If not, note it but it should already be present.

2. Clone zsh-bench if not already present:
   ```bash
   git clone https://github.com/romkatv/zsh-bench ~/zsh-bench
   ```

3. Run Stage 1 -- hyperfine external timing:
   ```bash
   hyperfine --warmup 3 --runs 10 'zsh -i -c exit'
   ```
   Record: mean, min, max, stddev.

4. Run Stage 2 -- EPOCHREALTIME internal profiling:
   - Create a temporary profiling wrapper that instruments .zshrc with EPOCHREALTIME tracing
   - Run `zsh -i -c exit` with instrumentation
   - Parse output to find top 20 slowest operations
   - Use the awk-based analysis from 19-RESEARCH.md: `awk '{if (prev) print $1-prev, $0; prev=$1}' /tmp/zsh_profile.$$ | sort -n -r | head -20`
   - Clean up instrumentation afterwards (restore original .zshrc)

5. Run Stage 3 -- zsh-bench interactive latency:
   ```bash
   ~/zsh-bench/zsh-bench
   ```
   Record: first_prompt_lag_ms, command_lag_ms, input_lag_ms.

6. Collect all results into a structured format for the SUMMARY.
  </action>
  <verify>
- `~/zsh-bench/zsh-bench` runs without error
- `hyperfine --version` outputs version
- All three stages produce numeric results
- EPOCHREALTIME profiling output includes at least 3 of: oh-my-posh, mise, carapace, zoxide, sheldon, ruby (SSH parsing) â€” this validates the profiling methodology is identifying expected bottlenecks before proceeding to quick wins
  </verify>
  <done>Three-stage baseline measurements recorded with specific numbers for hyperfine mean, EPOCHREALTIME top bottlenecks (validated against known suspects), and zsh-bench latency metrics.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Confirm baseline numbers are reasonable</name>
  <files></files>
  <action>
Present baseline results to user for confirmation. This is a human verification checkpoint -- no automated work required.

What was built: Three-stage performance baseline: hyperfine wall-clock timing, EPOCHREALTIME line-by-line profiling identifying top bottlenecks, and zsh-bench interactive latency metrics.

How to verify:
1. Review the baseline numbers presented in the summary
2. Confirm the hyperfine mean is approximately 870ms (matching known startup time)
3. Confirm the top bottlenecks from EPOCHREALTIME profiling align with known suspects (oh-my-posh, mise, carapace, zoxide, ruby SSH parsing)
4. Confirm zsh-bench metrics are reasonable
5. Approve to proceed to Plan 02 (apply quick wins)
  </action>
  <verify>User confirms baseline numbers are reasonable.</verify>
  <done>Baseline approved. Ready to proceed to Plan 02.</done>
</task>

</tasks>

<verification>
- zsh-bench cloned to ~/zsh-bench and executable
- hyperfine available
- Three measurement stages all produced results
- Results documented in SUMMARY
</verification>

<success_criteria>
Baseline measurements recorded and confirmed reasonable. Ready to apply quick wins in Plan 02 with a reference point for comparison.
</success_criteria>

<output>
After completion, create `.planning/phases/19-baseline-quick-wins/19-01-SUMMARY.md`
</output>
