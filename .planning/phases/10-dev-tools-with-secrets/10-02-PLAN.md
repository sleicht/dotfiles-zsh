---
phase: 10-dev-tools-with-secrets
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - scripts/verify-checks/10-dev-tools-secrets.sh
autonomous: true

must_haves:
  truths:
    - "Verification script confirms all Phase 10 configs are deployed correctly"
    - "Verification detects real files (not symlinks) for all Phase 10 configs"
    - "Verification confirms gpg-agent.conf has correct pinentry path (not Nix)"
    - "Verification handles tools not installed gracefully (non-fatal skip)"
  artifacts:
    - path: "scripts/verify-checks/10-dev-tools-secrets.sh"
      provides: "Phase 10 verification check file"
      contains: "Phase 10"
  key_links:
    - from: "scripts/verify-checks/10-dev-tools-secrets.sh"
      to: "scripts/verify-configs.sh"
      via: "Plugin discovery (verify-configs.sh finds and runs all check files)"
      pattern: "verify-checks"
---

<objective>
Create Phase 10 verification check file and run full verification to confirm all dev tool configs are correctly deployed.

Purpose: Validates that Plan 01's migration completed correctly using the Phase 7-9 verification framework. Checks file existence, symlink replacement, template rendering (gpg-agent), and tool parsability (non-fatal when tool not installed).

Output: Verification check file at scripts/verify-checks/10-dev-tools-secrets.sh, all checks passing.
</objective>

<execution_context>
@/Users/stephanlv_fanaka/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stephanlv_fanaka/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-dev-tools-with-secrets/10-RESEARCH.md
@.planning/phases/10-dev-tools-with-secrets/10-01-SUMMARY.md
@scripts/verify-checks/09-terminal-emulators.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Phase 10 verification check file</name>
  <files>scripts/verify-checks/10-dev-tools-secrets.sh</files>
  <action>
    Create scripts/verify-checks/10-dev-tools-secrets.sh following the Phase 9 verification pattern (scripts/verify-checks/09-terminal-emulators.sh).

    The check file must verify:

    Check 1 - File existence: All 6 config files exist at their deploy targets:
    - ~/.config/lazygit/config.yml
    - ~/.config/atuin/config.toml
    - ~/.config/atuin/atuin-keybindings.zsh
    - ~/.aider.conf.yml
    - ~/.gnupg/gpg-agent.conf
    - ~/.finicky.js (macOS only, check with [[ "$OSTYPE" == "darwin"* ]])

    Check 2 - Not-a-symlink: All config files are real files (not Dotbot symlinks). Use [ -e "$path" ] && [ ! -L "$path" ] pattern from Phase 9.

    Check 3 - No template errors: All static files should not contain unresolved template syntax. For gpg-agent.conf (the only template), verify it does not contain {{ or }} literal template markers.

    Check 4 - GPG agent pinentry path: Verify gpg-agent.conf does NOT contain the obsolete Nix path (/run/current-system/sw/bin/pinentry-mac). On macOS, verify it contains /opt/homebrew/bin/pinentry-mac. On Linux, verify it contains /usr/bin/pinentry-curses.

    Check 5 - Application parsability (non-fatal when app not installed):
    - lazygit: if command -v lazygit, run lazygit --version (confirms binary works)
    - atuin: if command -v atuin, run atuin doctor (validates config)
    - aider: if command -v aider, run aider --version (confirms binary works)
    - gpg-agent: if command -v gpg-agent, run gpg-agent --version
    - finicky: macOS only, no CLI validation available, just note if installed

    Check 6 - chezmoi managed: Verify chezmoi managed --include=files lists all Phase 10 configs. Use chezmoi managed (not chezmoi diff) to avoid triggering Bitwarden auth gate.

    Use the same structure as 09-terminal-emulators.sh: set -euo pipefail, source verify-lib/*.sh, colour output, check_pass/check_fail counters, results summary, exit 1 on failure.

    Make the file executable: chmod +x scripts/verify-checks/10-dev-tools-secrets.sh
  </action>
  <verify>
    ls -la scripts/verify-checks/10-dev-tools-secrets.sh (exists, executable)
    bash scripts/verify-checks/10-dev-tools-secrets.sh (all checks pass)
  </verify>
  <done>
    Phase 10 verification check file exists, is executable, and all checks pass when run.
  </done>
</task>

<task type="auto">
  <name>Task 2: Run full verification suite and confirm Phase 10 complete</name>
  <files></files>
  <action>
    Step 1: Run the Phase 10 verification check file:
    - bash scripts/verify-checks/10-dev-tools-secrets.sh
    All checks must pass. If any fail, diagnose and fix before proceeding.

    Step 2: Run the full verification suite to confirm no regressions:
    - bash scripts/verify-configs.sh (runs all check files including Phases 8, 9, 10)
    All phases must pass.

    Step 3: Verify Phase 10 success criteria from ROADMAP.md:
    1. lazygit loads chezmoi-managed configuration correctly -- confirmed by file existence + not-a-symlink + chezmoi managed
    2. atuin syncs shell history using Bitwarden-templated sync key -- N/A (sync disabled in current config, no sync key). Config deployed correctly for future enablement.
    3. aider uses API keys from environment variables (no embedded secrets) -- confirmed by no secrets in aider.conf.yml. No .aider.env created (no existing API key management via dotfiles).
    4. finicky browser routing works with chezmoi-managed config -- confirmed by file existence on macOS
    5. GPG agent uses OS-specific pinentry path from templated config -- confirmed by gpg-agent.conf containing correct Homebrew/Linux path

    Note on success criteria 2 and 3: The research anticipated Bitwarden integration for atuin sync key and aider API keys. However, current state shows:
    - atuin: auto_sync = false, no sync key configured. Static migration is correct.
    - aider: No API keys in config or .env file. Static migration is correct.
    If the user wants to enable these Bitwarden integrations later, atuin config.toml can be converted to .tmpl and an .aider.env.tmpl can be created.
  </action>
  <verify>
    bash scripts/verify-checks/10-dev-tools-secrets.sh exits 0
    bash scripts/verify-configs.sh exits 0 (no regressions)
  </verify>
  <done>
    Phase 10 verification passes. Full verification suite passes with no regressions. All 5 dev tool configs migrated to chezmoi.
  </done>
</task>

</tasks>

<verification>
1. scripts/verify-checks/10-dev-tools-secrets.sh exists and is executable
2. Phase 10 verification passes all checks (file existence, not-symlink, no template errors, pinentry path, chezmoi managed)
3. Full verification suite (all phases) passes with no regressions
4. Phase 10 ROADMAP success criteria addressed
</verification>

<success_criteria>
- Verification check file created and passing
- Full verification suite passes (Phases 8, 9, 10)
- No regressions in previously passing checks
- Phase 10 complete
</success_criteria>

<output>
After completion, create `.planning/phases/10-dev-tools-with-secrets/10-02-SUMMARY.md`
</output>
