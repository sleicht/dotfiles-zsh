---
phase: 05-tool-version-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ~/.local/share/chezmoi/private_dot_config/mise/config.toml.tmpl
  - ~/.local/share/chezmoi/.chezmoidata.yaml
autonomous: true

must_haves:
  truths:
    - "User has mise global config managed by chezmoi"
    - "User has global defaults for all managed runtimes (node, python, go, rust, java, ruby, terraform)"
    - "User can run chezmoi apply and mise config is deployed to ~/.config/mise/config.toml"
    - "User has [env] section in config for environment variable management (MISE-02)"
  artifacts:
    - path: "~/.local/share/chezmoi/private_dot_config/mise/config.toml.tmpl"
      provides: "Mise global configuration template"
      contains: "[tools]"
    - path: "~/.local/share/chezmoi/.chezmoidata.yaml"
      provides: "Mise tool versions data"
      contains: "mise:"
  key_links:
    - from: "~/.local/share/chezmoi/private_dot_config/mise/config.toml.tmpl"
      to: "~/.config/mise/config.toml"
      via: "chezmoi apply"
      pattern: "config\\.toml"
---

<objective>
Create chezmoi-managed mise global configuration with comprehensive tool defaults.

Purpose: Establish mise as the single source of truth for runtime version management, ensuring consistent tool versions across all machines through chezmoi templating.

Output: Mise config template deployed to ~/.config/mise/config.toml with global defaults for node, python, go, rust, java, ruby, and terraform.
</objective>

<execution_context>
@/Users/stephanlv_fanaka/.claude/get-shit-done/workflows/execute-plan.md
@/Users/stephanlv_fanaka/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-tool-version-migration/05-CONTEXT.md
@.planning/phases/05-tool-version-migration/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mise config directory structure in chezmoi</name>
  <files>~/.local/share/chezmoi/private_dot_config/mise/config.toml.tmpl</files>
  <action>
Create the directory structure and mise config template:

1. Create directory: `~/.local/share/chezmoi/private_dot_config/mise/`

2. Create `config.toml.tmpl` with:
```toml
# Managed by chezmoi - edit in ~/.local/share/chezmoi/
# mise global configuration
# Docs: https://mise.jdx.dev/configuration.html

[tools]
# Global tool versions (LTS/stable defaults)
# Project .tool-versions always overrides these
node = "lts"
python = "3.12"
go = "1.22"
rust = "stable"
java = "liberica-21"
ruby = "3"
terraform = "1.9"

[settings]
# Enable reading .nvmrc, .python-version, etc.
idiomatic_version_file_enable_tools = ["node", "python"]

# Auto-install missing tools when entering directories
not_found_auto_install = true
exec_auto_install = true
task_auto_install = true

# Performance settings
jobs = 4
verbose = false

# Prompt for confirmations on destructive operations
yes = false

[env]
# Global environment variables (MISE-02: env var management)
# Project-specific env vars can override via mise.toml [env] section
# Example: NODE_ENV = "development"
# Add global env vars here as needed
```

Note: Using `private_dot_config` prefix ensures ~/.config has correct permissions.
  </action>
  <verify>
- `ls -la ~/.local/share/chezmoi/private_dot_config/mise/config.toml.tmpl` exists
- File contains `[tools]`, `[settings]`, and `[env]` sections
  </verify>
  <done>Mise config template exists in chezmoi source directory with all required tool definitions and settings</done>
</task>

<task type="auto">
  <name>Task 2: Update .chezmoidata.yaml with mise tool versions</name>
  <files>~/.local/share/chezmoi/.chezmoidata.yaml</files>
  <action>
Update the tools.mise section in .chezmoidata.yaml to store global version preferences:

In the existing `tools:` section, replace the placeholder with:
```yaml
tools:
  mise:
    # Global runtime versions - used in config.toml template
    global_tools:
      node: "lts"
      python: "3.12"
      go: "1.22"
      rust: "stable"
      java: "liberica-21"
      ruby: "3"
      terraform: "1.9"
    settings:
      jobs: 4
      not_found_auto_install: true
      exec_auto_install: true
      idiomatic_version_files:
        - node
        - python
  sheldon:
    # Plugin list goes here when needed
```

This allows future templating of config.toml.tmpl from .chezmoidata.yaml if machine-specific versions are needed.
  </action>
  <verify>
- `grep -A 10 "mise:" ~/.local/share/chezmoi/.chezmoidata.yaml` shows global_tools section
- YAML is valid: `chezmoi data | grep mise`
  </verify>
  <done>.chezmoidata.yaml contains mise global tool versions data structure</done>
</task>

<task type="auto">
  <name>Task 3: Apply chezmoi and verify mise config deployed</name>
  <files>~/.config/mise/config.toml</files>
  <action>
1. Run `chezmoi apply` to deploy the mise config

2. Verify deployment:
   - `cat ~/.config/mise/config.toml` shows the config content
   - `mise config` shows config is loaded
   - `mise settings` shows settings are applied

3. If existing ~/.config/mise/config.toml has different content, chezmoi will update it
  </action>
  <verify>
- `cat ~/.config/mise/config.toml` shows [tools] section with node, python, go, rust, java, ruby, terraform
- `mise settings | grep not_found_auto_install` shows true
- `chezmoi verify` passes (no diff)
  </verify>
  <done>Mise global config deployed via chezmoi and settings are active</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Config deployment:
   - `chezmoi verify` passes
   - `~/.config/mise/config.toml` matches template output
   - `mise config ls` shows config is loaded

2. Settings verification:
   - `mise settings` shows not_found_auto_install=true, jobs=4
   - `mise doctor` shows no errors
</verification>

<success_criteria>
- Mise config template exists at ~/.local/share/chezmoi/private_dot_config/mise/config.toml.tmpl
- .chezmoidata.yaml has mise tool versions data
- chezmoi apply deploys config to ~/.config/mise/config.toml
- mise reads config successfully (mise config ls shows it)
- Auto-install settings enabled (mise settings confirms)
</success_criteria>

<output>
After completion, create `.planning/phases/05-tool-version-migration/05-01-SUMMARY.md`
</output>
